name: Run Tests if Return Exists

on:
  push:
    paths:
      - 'solutions/**'
      - 'tests/**'

jobs:
  check-and-test:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout Code
      uses: actions/checkout@v3

    - name: Check for 'return' in Solutions
      id: check_return
      run: |
        echo "checking files..."
        result=""

        for lang in c cpp java py; do
          file="solutions/solution.$lang"
          if [ -f "$file" ]; then
            if grep -q "return" "$file"; then
              echo "$lang=true" >> $GITHUB_ENV
              result="${result}1"
            else
              echo "$lang=false" >> $GITHUB_ENV
              result="${result}0"
            fi
          fi
        done

        echo "result=$result" >> $GITHUB_OUTPUT

    - name: Run C Test
      if: env.c == 'true'
      run: |
        gcc solutions/solution.c tests/test.c -o test_c
        ./test_c

    - name: Run C++ Test
      if: env.cpp == 'true'
      run: |
        g++ solutions/solution.cpp tests/test.cpp -o test_cpp
        ./test_cpp

    - name: Run Java Test
      if: env.java == 'true'
      run: |
        javac solutions/solution.java tests/test.java
        java test

    - name: Run Python Test
      if: env.py == 'true'
      run: |
        python3 tests/test.py
